# æ–‡ä»¶å: .github/workflows/android_build.yml

name: Android Build with Kivy-A.T.

# è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç æ¨é€åˆ° 'main' åˆ†æ”¯æ—¶ï¼Œæˆ–æ‰‹åŠ¨ç‚¹å‡»è¿è¡Œæ—¶
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    # 1. å®‰è£… buildozer è¿è¡Œç¯å¢ƒ (å·²åŒ…å« openjdk-17-jdk)
    - name: Set up Buildozer Environment
      run: |
        sudo apt update
        sudo apt install -y build-essential python3-pip git openjdk-17-jdk

    # 2. å®‰è£… Python ä¾èµ–
    - name: Install Python Dependencies
      run: |
        pip install buildozer pip
        # Kivy/Buildozer å¯¹ Cython ç‰ˆæœ¬å¾ˆæ•æ„Ÿï¼Œä½¿ç”¨ç¨³å®šç‰ˆæœ¬
        pip install cython==0.29.36

    # ğŸŒŸ ä¿®æ­£å¹¶æ–°å¢çš„æ­¥éª¤ï¼šæ¥å— Android SDK è®¸å¯è¯ ğŸŒŸ
    # è¿™ä¸€æ­¥å¿…é¡»åœ¨ Buildozer å°è¯•ä¸‹è½½ SDK ä¹‹å‰å®Œæˆï¼Œä»¥è§£å†³æ‚¨é‡åˆ°çš„ "license is not accepted" é”™è¯¯ã€‚
    - name: Accept Android SDK Licenses
      run: |
        # åˆ›å»º licenses ç›®å½•
        mkdir -p $ANDROID_HOME/licenses
        # å†™å…¥ SDK è®¸å¯è¯å“ˆå¸Œ
        echo "2433ddef7fe487ef9c12257c191a92e18ae5703f" > $ANDROID_HOME/licenses/android-sdk-license
        echo "84831b940e6990c46a6f1317565b535028883d6a" > $ANDROID_HOME/licenses/android-sdk-preview-license

    # 3. è¿è¡Œ buildozer ç¼–è¯‘ (Buildozer ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…ç¼ºå¤±çš„ SDK ç»„ä»¶)
    - name: Run Buildozer Android Debug
      run: buildozer android debug

    # 4. ä¸Šä¼ ç”Ÿæˆçš„ APK æ–‡ä»¶
    - name: Upload APK Artifact
      uses: actions/upload-artifact@v4
      with:
        name: android-debug-apk
        path: bin/*.apk
